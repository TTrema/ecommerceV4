{% extends "base.html" %}

{% block extra_head %}
<style>

</style>
{% endblock extra_head %}

{% block content %}



<body style="text-align: center; height: 100vh;">
     <!-- Add meta tags for mobile and IE -->
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <meta http-equiv="X-UA-Compatible" content="IE=edge" />
     <title> PayPal Checkout Integration | Server Demo </title>
 </head>
 
 <body>
     <!-- Set up a container element for the button -->
     <form id='form'>
      {% csrf_token %}
     <div id="paypal-button-container"></div>
 
     <!-- Include the PayPal JavaScript SDK -->
     <script src="https://www.paypal.com/sdk/js?client-id={{ paypalid }}&currency=BRL"></script>
 
     <script>
         // Render the PayPal button into #paypal-button-container
         paypal.Buttons({
 
             // Call your server to set up the transaction
             createOrder: function(data, actions) {
           return actions.order.create({
             purchase_units: [{
               "amount": {
                 "currency_code": "BRL",
                 "value": {{ paypaltotal }}
               }
             }]
           });
         },
                 
             // Call your server to finalize the transaction


             
             onApprove: function(data, actions) {
              var form = document.getElementById('form')
              csrftoken = form.getElementsByTagName("input")[0].value
              var url = "{% url 'core:payment_complete' %}"
              return fetch(url, {
                method: 'POST',
                headers: {
                  'content-type': 'application/json',
                  'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({
                  orderID: data.orderID
                })
              }).then(function () {
                location.href = '';
              })
            },
          }).render('#paypal-button-container');
         
          initPayPalButton();
          
          </script>  

    </form>
 </body>
 
 </html>
        
        <ul class="list-group" style="max-width: 1000px; margin: auto;" >
          
        {% for order_item in order.items.all %}   
        <li class="list-group-item d-flex  lh-condensed">
            <div>
            <h5 class="my-0">{{ order_item.quantity }} x {{ order_item.product.name|truncatechars:42 }}</h5>
        
            </div>
            <span class="text-muted">R$ {{ order_item.get_final_price }}</span>
        </li>
        {% endfor %}
        {% if order.coupon %}
        <li class="list-group-item d-flex justify-content-between bg-light">
            <div class="text-success">
            <h6 class="my-0">Cupom</h6>
            <small>{{ order.coupon.code }}</small>
            </div>
            <span class="text-success">-R$ {{ order.coupon.amount }}</span>
            
        </li>
        
        {% endif %}
        <li class="list-group-item d-flex justify-content-between">
            <span>Total </span>
            R$ {{ order.get_total }}
        </li>
    
        <li class="list-group-item d-flex justify-content-between lh-condensed ">
      
          <div class="my-0">Valor do frete:       
          </div>
          <span class="text-muted">R$ {{ order.get_frete_valor }}</span>
      </li>    

      <li class="list-group-item d-flex justify-content-between lh-condensed ">
      
        <div>
        <h2 class="my-0"><strong>Valor total a pagar:</strong>      
        </div>
        <strong> R$ {{ order.get_total_frete }}</strong></h2> 
    </li>  
    <ul> 
      </div>

    </div>
  </main>

{% endblock content %}

