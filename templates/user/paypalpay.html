{% extends "base.html" %}

{% block extra_head %}
<style>

#stripeBtnLabel {
  font-family: "Helvetica Neue", Helvetica, sans-serif;
  font-size: 16px;
  font-variant: normal;
  padding: 0;
  margin: 0;
  -webkit-font-smoothing: antialiased;
  font-weight: 500;
  display: block;
}

#stripeBtn {
  border: none;
  border-radius: 4px;
  outline: none;
  text-decoration: none;
  color: #fff;
  background: #32325d;
  white-space: nowrap;
  display: inline-block;
  height: 40px;
  line-height: 40px;
  box-shadow: 0 4px 6px rgba(50, 50, 93, .11), 0 1px 3px rgba(0, 0, 0, .08);
  border-radius: 4px;
  font-size: 15px;
  font-weight: 600;
  letter-spacing: 0.025em;
  text-decoration: none;
  -webkit-transition: all 150ms ease;
  transition: all 150ms ease;
  float: left;
  width: 100%
}

button:hover {
  transform: translateY(-1px);
  box-shadow: 0 7px 14px rgba(50, 50, 93, .10), 0 3px 6px rgba(0, 0, 0, .08);
  background-color: #43458b;
}

.stripe-form {
  padding: 5px 30px;
}

#card-errors {
  height: 20px;
  padding: 4px 0;
  color: #fa755a;
}

.stripe-form-row {
  width: 100%;
  float: left;
  margin-top: 5px;
  margin-bottom: 5px;
}

/**
 * The CSS shown here will not be introduced in the Quickstart guide, but shows
 * how you can use CSS to style your Element's container.
 */
.StripeElement {
  box-sizing: border-box;

  height: 40px;

  padding: 10px 12px;

  border: 1px solid transparent;
  border-radius: 4px;
  background-color: white;

  box-shadow: 0 1px 3px 0 #e6ebf1;
  -webkit-transition: box-shadow 150ms ease;
  transition: box-shadow 150ms ease;der_sni
}

.StripeElement--focus {
  box-shadow: 0 1px 3px 0 #cfd7df;
}

.StripeElement--invalid {
  border-color: #fa755a;
}

.StripeElement--webkit-autofill {
  background-color: #fefde5 !important;
}

.current-card-form {
  display: none;
}

</style>
{% endblock extra_head %}

{% block content %}

  <main >
    <body style="text-align: center; height: 100vh;">
    <div class="container wow fadeIn">

      <h2 class="my-5 h2 text-center">Pagar com paypal</h2>    

      <div class="row">


        <div id="paypal-button-container"></div>
      </div>
      </div>
      </div>
      <script
      src="https://www.paypal.com/sdk/js?client-id={{ paypalid }}&currency=BRL"
      data-sdk-integration-source="button-factory">
      </script>
      <script>
      function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
      }
      var csrftoken = getCookie('csrftoken');
      
      
      
      function initPayPalButton() {
      paypal.Buttons({
        style: {
          shape: 'rect',
          color: 'gold',
          layout: 'vertical',
          label: 'paypal',
      
        },
      createOrder: function (data, actions) {
          return actions.order.create({
            purchase_units: [{
              "amount": {
                "currency_code": "BRL",
                "value": {{ paypaltotal }}
              }
            }]
          });
        },
      onApprove: function (data) {
        var url = "{% url 'core:payment_complete' %}"
          return fetch(url, {
            method: 'POST',
            headers: {
              'content-type': 'application/json',
              'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({
              orderID: data.orderID
            })
          }).then(function () {
            location.href = '';
          })
        },
      }).render('#paypal-button-container');
      }
      initPayPalButton();
      
      </script>           

          </div>
        </div>
        
        <ul class="list-group" style="max-width: 1000px; margin: auto;" >
          
        {% for order_item in order.items.all %}   
        <li class="list-group-item d-flex  lh-condensed">
            <div>
            <h5 class="my-0">{{ order_item.quantity }} x {{ order_item.product.name|truncatechars:42 }}</h5>
        
            </div>
            <span class="text-muted">R$ {{ order_item.get_final_price }}</span>
        </li>
        {% endfor %}
        {% if order.coupon %}
        <li class="list-group-item d-flex justify-content-between bg-light">
            <div class="text-success">
            <h6 class="my-0">Cupom</h6>
            <small>{{ order.coupon.code }}</small>
            </div>
            <span class="text-success">-R$ {{ order.coupon.amount }}</span>
            
        </li>
        
        {% endif %}
        <li class="list-group-item d-flex justify-content-between">
            <span>Total </span>
            R$ {{ order.get_total }}
        </li>
    
        <li class="list-group-item d-flex justify-content-between lh-condensed ">
      
          <div class="my-0">Valor do frete:       
          </div>
          <span class="text-muted">R$ {{ order.get_frete_valor }}</span>
      </li>    

      <li class="list-group-item d-flex justify-content-between lh-condensed ">
      
        <div>
        <h2 class="my-0"><strong>Valor total a pagar:</strong>      
        </div>
        <strong> R$ {{ order.get_total_frete }}</strong></h2> 
    </li>  
    <ul> 
      </div>

    </div>
  </main>

{% endblock content %}

{% block extra_scripts %}



{% endblock extra_scripts %}




